@model FinalProject.Models.Users

@{
    ViewData["Title"] = "Details";
}

    <head>
        <title>Chart Display</title>

    </head>

    <body onload="requestJSONData();">
        <h2>Details</h2>
        <div>
            <hr />
            <fieldset>
                <legend>
                    User details:
                    <dl class="dl-horizontal" align="left">
                        <dt align="left">
                            Username:
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Username)
                        </dd>
                        <dt align="left">
                            Initial balance:
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Amount)
                        </dd>
                        <dt align="left">
                            Member since:
                        </dt>
                        <dd>
                            @Html.DisplayFor(model => model.Created_At)
                        </dd>
                    </dl>
                </legend>
            </fieldset>
        </div>
        <table border="1px solid black" ;>
            <tr>
                <th> Symbol </th>
                <th> Current Shares </th>
                <th> Amount Invested </th>
                <th> Price </th>
                <th> Current Shares (this can be adjusted) </th>
                <th> Change Investments? </th>
            </tr>
            @using System.Net;
            @using Newtonsoft.Json;
            @foreach (var item in Model.StockPurchaseEntry)
            {


                string Id = item.Company_Name.ToString();
                string Purchased_Amount = item.Purchased_Amount.ToString();
                string Amount_Paid = item.Amount_Paid.ToString();
                string Created_At = item.Created_At.ToString();


                var coinString = Id;
                var uri = $"https://min-api.cryptocompare.com/data/pricemulti?fsyms={coinString}&tsyms=USD";

                WebClient client = new WebClient();
                string rawData = client.DownloadString(uri);

                dynamic stuff = JsonConvert.DeserializeObject(rawData);
                string price = stuff[Id].USD;


                    <tr>
                        <td id=CompSymbol1>@Html.DisplayFor(modelItem => Id)</td>
                        <td id=CompCurPrice1>@Html.DisplayFor(modelItem => Purchased_Amount)</td>
                        <td id=UserInvestment1>@Html.DisplayFor(modelItem => Amount_Paid)</td>
                        <td id=UserEarnings1>@Html.DisplayFor(modelItem => price)</td>
                        <td id=UserEarnings1>@Html.DisplayFor(modelItem => Created_At)</td>
                        <td><input type="text" id=CompCurrShares1></td>
                    </tr>
        }
        </table>
        <input align="center" type="button" id="updateBtn" onclick="updateUserDataFromChart()" value="UPDATE" />
        <h1 align="center"> Your Chart </h1>
        <div id="pieChart"></div>
        <p></p>
        <div align="center">
          <input align="center" type="button" id="pieChart" value="PIE" onclick="requestCoinListData()"/>
          <input align="center" type="button" id="barChart" value="BAR" />
          <input align="center" type="button" id="lineChart" value="LINE" />
          <p></p>
          <a asp-action="Index">Logout</a>
        </div>

    </body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script type="text/javascript" src="~/js/site.js"></script>

@section scripts{
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        var chartData = '@Model.StockPurchaseEntry';
        console.log("chart data: ");
        console.log(chartData);

        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Currency');
            data.addColumn('number', 'NumShares');
            data.addRows([
              [chartData.Company_Name.ToString(), chartData.Purchased_Amount.ToString()]
            ]);

            // Simple Pie Chart:
            var option = {
                title: 'Currency Pie Chart',
                width: 500,
                height: 400
            };

            var chart = new google.visualization.PieChart(document.getElementById('pieChart'));
            chart.draw(data, option);
        }
    </script>
}
